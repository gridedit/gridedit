(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},w={}.hasOwnProperty,x=function(a,b){function c(){this.constructor=a}for(var d in b)w.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};t=function(){function a(){}return a.prototype.setAttributes=function(a,b){var c,d,e;e=[];for(c in b)d=b[c],e.push(d?a.setAttribute(c,d):void 0);return e},a.prototype.setStyles=function(a,b){var c,d,e;e=[];for(c in b)d=b[c],e.push(a.style[c]=""+d+"px");return e},a.prototype.clearActiveCells=function(a){var b,c,d,e,f,g,h,i,j;if(f=a.redCells,c=a.activeCells,f.length>0){for(d=g=0,i=f.length;i>g;d=++g)e=f[d],null!=e&&e.makeInactive();a.redCells=[]}if(c.length>0){for(d=h=0,j=c.length;j>h;d=++h)b=c[d],null!=b&&b.makeInactive(),null!=b&&b.hideControl();a.activeCells=[]}return a.selectionStart=null,a.selectionEnd=null,a.contextMenu.hide(),a.selectedCol?a.selectedCol.makeInactive():void 0},a.prototype.capitalize=function(a){return a.toLowerCase().replace(/\b./g,function(a){return a.toUpperCase()})},a}(),i=function(){function b(b,c){var e,f,g,h;if(this.config=b,this.actionStack=c,this.element=document.querySelectorAll(this.config.element||"#gridedit")[0],this.dragBorderStyle=this.config.dragBorderStyle||"3px solid rgb(160, 195, 240)",this.draggingRow=null,this.lastDragOver=null,this.lastDragOverIsBeforeFirstRow=!1,this.headers=[],this.rows=[],this.subtotalRows=[],this.cols=[],this.source=this.config.rows,this.redCells=[],this.activeCells=[],this.copiedCells=null,this.selectionStart=null,this.selectionEnd=null,this.selectedCol=null,this.openCell=null,this.state="ready",this.mobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this.topOffset=this.config.topOffset?this.config.topOffset:0,this.cellStyles={activeColor:"#FFE16F",uneditableColor:"#FFBBB3"},this.config.custom){h=this.config.custom;for(f in h)g=h[f],f in this.config.custom&&this.set(f,g);delete this.config.custom}this.config.initialize&&this.init(),this.copiedCellMatrix=null,this.contextMenu=new d(this),this.actionStack||(this.actionStack=new a(this)),this.config.selectedCell&&(e=this.getCell(this.config.selectedCell[0],this.config.selectedCell[1]),e&&e.makeActive(),this.config.selectedCell=void 0)}return b.prototype.init=function(){this.config.beforeInit&&this.config.beforeInit(),this.build(),this.events(),this.render(),this.config.afterInit&&this.config.afterInit()},b.prototype.build=function(){var a,b,d,e,f,h,i,j,k,m,n,o,q,s,u,v,w;for(n=document.createElement("tr"),this.config.includeRowHandles&&(e=document.createElement("th"),n.appendChild(e)),v=this.config.cols,f=o=0,s=v.length;s>o;f=++o)b=v[f],a=new c(b,this),this.cols.push(a),n.appendChild(a.element);for(m=document.createElement("thead"),d=this,m.ondragenter=function(){var a;return d.lastDragOverIsBeforeFirstRow=!0,a=d.lastDragOver,a.element.style.borderBottom=a.oldBorderBottom,a.element.style.borderTop=d.dragBorderStyle},m.ondragleave=function(){var a;return a=d.rows[0],a.element.style.borderTop=a.oldBorderTop},m.appendChild(n),k=document.createElement("tbody"),w=this.source,f=q=0,u=w.length;u>q;f=++q){switch(i=w[f],i.gridEditRowType){case"static":h=new p(i,this);break;case"subtotal":h=new r(i,this);break;case"heading":h=new l(i,this);break;default:h=new g(i,this)}this.rows.push(h),k.appendChild(h.element)}return j=document.createElement("table"),t.prototype.setAttributes(j,{id:"editable-grid","class":this.config.tableClass}),j.appendChild(m),j.appendChild(k),this.tableEl=j},b.prototype.rebuild=function(a){var b,c,d,e;if(null==a&&(a=null),c=Object.create(this.config),null!==a)for(d in a)e=a[d],c[d]=a[d];return b=this.actionStack,this.destroy(),this.constructor(c,b)},b.prototype.events=function(){var a,b,c;return c=this,b=c.moveTo,a=c.edit,document.onkeydown=function(d){var e,f,g,h,i,j;if(c.activeCell())if(g=d.keyCode,i=d.shiftKey,f=d.ctrlKey,e=d.metaKey,j=function(a,b){var c;return c=String.fromCharCode(a),b?c:c.toLowerCase()},h=function(){return c.openCell?void 0:c.activeCell().showControl(j(g,i))},e||f){if(g&&91!==g&&92!==g&&c.contextMenu.actionCallbacks.byControl[g])return d.preventDefault(),c.contextMenu.actionCallbacks.byControl[g](d,c)}else switch(g){case 39:if(!c.activeCell().isBeingEdited())return b(c.nextCell());break;case 9:return b(i?c.previousCell():c.nextCell());case 37:return b(c.previousCell());case 38:return b(c.aboveCell());case 40:return b(c.belowCell());case 32:if(!c.openCell)return a(c.activeCell());break;case 13:break;case 16:break;case 17:break;case 91:break;case 8:if(!c.openCell)return d.preventDefault(),c["delete"]();break;case 46:if(!c.openCell)return d.preventDefault(),c["delete"]();break;default:return v.call([96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111],g)>=0&&(g-=48),h()}},window.onresize=function(){return c.openCell?t.prototype.setStyles(c.openCell.control,c.openCell.position()):void 0},window.onscroll=function(){return c.openCell?c.openCell.reposition():void 0},this.tableEl.oncontextmenu=function(){return!1},document.onclick=function(a){var b;return c.isDescendant(a.target)||a.target===(null!=(b=c.activeCell())?b.control:void 0)||c.contextMenu.isVisible()||t.prototype.clearActiveCells(c),c.contextMenu.hide()}},b.prototype.render=function(){return this.element.hasChildNodes()&&(this.element=document.querySelectorAll(this.config.element||"#gridedit")[0]),this.element.appendChild(this.tableEl)},b.prototype.set=function(a,b){return void 0!==a?this.config[a]=b:void 0},b.prototype.getCell=function(a,b){var c;try{return this.rows[a].cells[b]}catch(d){c=d}},b.prototype.activeCell=function(){return this.activeCells.length>1?this.activeCells:this.activeCells[0]},b.prototype.nextCell=function(){var a;return null!=(a=this.activeCell())?a.next():void 0},b.prototype.previousCell=function(){var a;return null!=(a=this.activeCell())?a.previous():void 0},b.prototype.aboveCell=function(){var a;return null!=(a=this.activeCell())?a.above():void 0},b.prototype.belowCell=function(){var a;return null!=(a=this.activeCell())?a.below():void 0},b.prototype.moveTo=function(a,b){var c,d,e,f,g;return a&&(void 0===b&&(b=a.table.activeCell()),d=a.table.getDirection(b,a),a.beforeNavigateTo&&(c=a.beforeNavigateTo(a,b,d)),c!==!1&&(a.isVisible()||(g=a.table.activeCell().address[0],f=a.address[0],e=1,g>f&&(e=-1),window.scrollBy(0,(null!=a?a.position().height:void 0)*e)),a.makeActive())),!1},b.prototype.getDirection=function(a,b){var c,d,e,f,g;return e=a.address[0],g=b.address[0],d=a.address[1],f=b.address[1],e===g?d>f?c="left":f>d?c="right":console.log("Cannot calculate direction going from cell "+a.address+" to cell "+b.address):e>g?c="up":g>e?c="down":console.log("Cannot calculate direction going from cell "+a.address+" to cell "+b.address),c},b.prototype.edit=function(a,b){return null==b&&(b=null),null!==b?null!=a?a.edit(b):void 0:(null!=a&&a.edit(),!1)},b.prototype["delete"]=function(){var a,b,c,d,e;for(d=this.activeCells,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.value(""));return e},b.prototype.clearActiveCells=function(){return t.prototype.clearActiveCells(this)},b.prototype.setSelection=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(this.selectionStart&&this.selectionEnd&&this.selectionStart!==this.selectionEnd){for(l=this.activeCells,f=0,h=l.length;h>f;f++)a=l[f],a.showInactive();for(this.activeCells=[],e=function(){o=[];for(var a=m=this.selectionStart.address[0],b=this.selectionEnd.address[0];b>=m?b>=a:a>=b;b>=m?a++:a--)o.push(a);return o}.apply(this),c=function(){p=[];for(var a=n=this.selectionStart.address[1],b=this.selectionEnd.address[1];b>=n?b>=a:a>=b;b>=n?a++:a--)p.push(a);return p}.apply(this),g=0,i=e.length;i>g;g++)for(d=e[g],k=0,j=c.length;j>k;k++)b=c[k],this.rows[d].cells[b].addToSelection()}},b.prototype.data=function(){var a,b,c,d,e,f,g,h,i,j;for(b=[],i=this.rows,e=0,g=i.length;g>e;e++){for(c=i[e],d=[],j=c.cells,f=0,h=j.length;h>f;f++)a=j[f],d.push(a.cellTypeObject.value());b.push(d)}return b},b.prototype.repopulate=function(){var a,b,c,d,e,f;for(e=this.rows,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(function(){var c,d,e,f;for(e=b.cells,f=[],c=0,d=e.length;d>c;c++)a=e[c],f.push(a.value(a.source[a.valueKey]));return f}());return f},b.prototype.destroy=function(){var a,b;this.element.removeChild(this.tableEl),b=[];for(a in this)b.push(delete this[a]);return b},b.prototype.isDescendant=function(a){var b;for(b=a.parentNode;null!=b;){if(b===this.tableEl)return!0;b=b.parentNode}return!1},b.prototype.addToStack=function(a){return this.actionStack.addAction(a)},b.prototype.undo=function(){return this.actionStack.undo()},b.prototype.redo=function(){return this.actionStack.redo()},b.prototype.moveRow=function(a,b,c){var d;return null==c&&(c=!0),d=this.source[a],this.source.splice(a,1),this.source.splice(b,0,d),c&&this.addToStack({type:"move-row",oldIndex:a,newIndex:b}),this.rebuild({rows:this.source,initialize:!0,selectedCell:[b,0]})},b.prototype.addRow=function(a,b,c){var d,e,f,g,h;if(null==b&&(b=!0),null==c&&(c=!1),c)e=c;else for(e={},h=this.cols,f=0,g=h.length;g>f;f++)d=h[f],e[d.valueKey]=d.defaultValue||"";return a||0===a?this.source.splice(a,0,e):(a=this.source.length-1,this.source.push(e)),b&&this.addToStack({type:"add-row",index:a,rowObject:c}),this.rebuild({rows:this.source,initialize:!0,selectedCell:[a,0]})},b.prototype.insertBelow=function(){var a;return a=this.contextMenu.getTargetPasteCell(),this.addRow(a.address[0]+1)},b.prototype.insertAbove=function(){var a;return a=this.contextMenu.getTargetPasteCell(),this.addRow(a.address[0])},b.prototype.removeRow=function(a,b){var c,d,e;return null==b&&(b=!0),d=this.source[a],c=this.rows[a],e=this.source.splice(a,1),b&&this.addToStack({type:"remove-row",index:a,rowObject:d}),this.rebuild({rows:this.source,initialize:!0,selectedCell:[a,0]})},b.prototype.selectRow=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(this.activeCell()&&a){if(e=this.activeCells[0].address[0],h=a.shiftKey,d=a.ctrlKey,c=a.metaKey,d||c||t.prototype.clearActiveCells(this),h){if(f=e-b,0>f){for(m=this.rows.slice(e,+b+1||9e9),o=[],i=0,k=m.length;k>i;i++)g=m[i],o.push(g.select());return o}for(n=this.rows.slice(b,+e+1||9e9),p=[],j=0,l=n.length;l>j;j++)g=n[j],p.push(g.select());return p}return g=this.rows[b],g.select()}return g=this.rows[b],g.select()},b.prototype.calculateSubtotals=function(){var a,b,c,d,e;for(d=this.subtotalRows,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.calculate());return e},b}(),c=function(){function a(a,b){var c,d,e,f;this.attributes=a,this.table=b,this.id=this.index=this.table.cols.length,this.defaultValue=this.attributes.defaultValue,this.cellClass=this.attributes.cellClass,this.cells=[],this.element=document.createElement("th"),this.textNode=document.createTextNode(this.attributes.label),this.element.appendChild(this.textNode),c=this.attributes.format,this.format=function(a){return c?c(a):a},f=this.attributes;for(d in f)e=f[d],this[d]=e;delete this.attributes,this.events()}return a.prototype.next=function(){return this.table.cols[this.index+1]},a.prototype.previous=function(){return this.table.cols[this.index-1]},a.prototype.makeActive=function(){return this.element.classList.add("active"),this.table.selectedCol=this},a.prototype.makeInactive=function(){return this.element.classList.remove("active"),this.table.selectedCol=null},a.prototype.events=function(){var a,b;return a=this,b=a.table,this.element.onclick=function(){var c,d,e,f,g;for(t.prototype.clearActiveCells(b),a.makeActive(),f=a.cells,g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(c.addToSelection());return g},this.element.onmousedown=function(c){return 3===c.which?void b.contextMenu.show(c.x,c.y,a.cells[0]):!1}},a}(),b=function(){function a(a,b,c){var d;if(this.originalValue=a,this.row=b,void 0===this.originalValue&&(this.originalValue=""),this.id=""+this.row.id+"-"+this.row.cells.length,this.address=[this.row.id,this.row.cells.length],this.index=this.row.cells.length,this.table=this.row.table,this.col=this.table.cols[this.index],this.type=c||this.col.type,this.meta=this.col,this.editable=this.col.editable!==!1,this.element=document.createElement("td"),this.col.cellClass&&this.element.classList.add(this.col.cellClass),this.valueKey=this.col.valueKey,this.source=this.table.config.rows[this.address[0]],this.source[this.valueKey]=this.originalValue,this.initCallbacks(),this.col.style)for(d in this.col.style)this.element.style[d]=this.col.style[d];switch(this.type){case"string":this.cellTypeObject=new q(this);break;case"number":this.cellTypeObject=new m(this);break;case"date":this.cellTypeObject=new e(this);break;case"html":this.cellTypeObject=new j(this);break;case"select":this.cellTypeObject=new o(this);break;case"textarea":this.cellTypeObject=new s(this)}this.events(this)}return a.prototype.initCallbacks=function(){return this.table.config.beforeEdit&&(this.beforeEdit=this.table.config.beforeEdit),this.table.config.afterEdit&&(this.afterEdit=this.table.config.afterEdit),this.table.config.beforeCellActivate&&(this.beforeActivate=this.table.config.beforeCellActivate),this.table.config.afterCellActivate&&(this.afterActivate=this.table.config.afterCellActivate),this.table.config.beforeControlInit&&(this.beforeControlInit=this.table.config.beforeControlInit),this.table.config.afterControlInit&&(this.afterControlInit=this.table.config.afterControlInit),this.table.config.beforeControlHide&&(this.beforeControlHide=this.table.config.beforeControlHide),this.table.config.afterControlHide&&(this.afterControlHide=this.table.config.afterControlHide),this.table.config.onCellClick&&(this.onClick=this.table.config.onCellClick),this.table.config.beforeCellNavigateTo?this.beforeNavigateTo=this.table.config.beforeCellNavigateTo:void 0},a.prototype.value=function(a,b){var c;return null==a&&(a=null),null==b&&(b=!0),null!==a&&a!==this.element.textContent?(a=this.cellTypeObject.formatValue(a),c=this.value(),this.beforeEdit&&this.beforeEdit(this,c,a),b&&this.table.addToStack({type:"cell-edit",oldValue:c,newValue:a,address:this.address}),this.element.textContent=this.col.format(a),this.cellTypeObject.setValue(a),this.control&&t.prototype.setStyles(this.control,this.position()),this.row.afterEdit(),this.afterEdit&&this.afterEdit(this,c,a,this.table.contextMenu.getTargetPasteCell()),a):this.source[this.valueKey]},a.prototype.makeActive=function(a){var b;return null==a&&(a=!0),a&&t.prototype.clearActiveCells(this.table),!this.isActive()&&(this.beforeActivate&&(b=this.beforeActivate(this)),(this.beforeActivate&&b!==!1||!this.beforeActivate)&&(this.showActive(),this.table.activeCells.push(this),this.table.selectionStart=this,this.table.openCell&&this.table.openCell.edit(this.table.openCell.control.value),this.afterActivate))?this.afterActivate(this):void 0},a.prototype.makeInactive=function(){return this.showInactive()},a.prototype.addToSelection=function(){return this.showActive(),this.table.activeCells.push(this)},a.prototype.isActive=function(){return-1!==this.table.activeCells.indexOf(this)},a.prototype.removeFromSelection=function(){var a;return a=this.table.activeCells.indexOf(this),this.table.activeCells.splice(a,1),this.showInactive()},a.prototype.showActive=function(){var a;return this.isActive()?void 0:(a=this.element.style.cssText,this.oldCssText=a,this.element.style.cssText=a+" "+("background-color: "+this.table.cellStyles.activeColor+";"))},a.prototype.showInactive=function(){return this.element.style.cssText=this.oldCssText},a.prototype.showRed=function(){return this.element.style.cssText="background-color: "+this.table.cellStyles.uneditableColor+";",this.table.redCells.push(this)},a.prototype.showControl=function(a){var b,c;return null==a&&(a=null),this.table.copiedCellMatrix&&this.table.contextMenu.hideBorders(),this.editable?(this.beforeControlInit&&(b=this.beforeControlInit(this)),(this.beforeControlInit&&b!==!1||!this.beforeControlInit)&&(null!==a?(this.control.value=a,c=this.control,setTimeout(function(){return c.focus()},0)):this.cellTypeObject.initControl(),this.control.style.position="fixed",t.prototype.setStyles(this.control,this.position()),this.table.element.appendChild(this.control),this.table.openCell=this,this.afterControlInit)?this.afterControlInit(this):void 0):this.showRed()},a.prototype.hideControl=function(){var a;return null!==this.table.openCell&&(this.beforeControlHide&&(a=this.beforeControlHide(this)),(this.beforeControlHide&&a!==!1||!this.beforeControlHide)&&(this.isControlInDocument()&&this.control.parentNode.removeChild(this.control),this.table.openCell=null,this.afterControlHide))?this.afterControlHide(this):void 0},a.prototype.edit=function(a){return null==a&&(a=null),this.editable?null!==a?(this.value(a),this.isBeingEdited()?this.hideControl():this.edit()):(this.showControl(),this.control.focus(),this.cellTypeObject.select()):this.showRed()},a.prototype.position=function(){return this.element.getBoundingClientRect()},a.prototype.isVisible=function(){var a;return a=this.position(),a.top>=this.table.topOffset&&a.bottom<=window.innerHeight},a.prototype.isControlInDocument=function(){return null!==this.control.parentNode},a.prototype.reposition=function(){return t.prototype.setStyles(this.control,this.position())},a.prototype.next=function(){var a;return this.row.cells[this.index+1]||(null!=(a=this.row.below())?a.cells[0]:void 0)},a.prototype.previous=function(){var a;return this.row.cells[this.index-1]||(null!=(a=this.row.above())?a.cells[this.row.cells.length-1]:void 0)},a.prototype.above=function(){var a;return null!=(a=this.row.above())?a.cells[this.index]:void 0},a.prototype.below=function(){var a;return null!=(a=this.row.below())?a.cells[this.index]:void 0},a.prototype.isBefore=function(a){return a.address[0]===this.address[0]&&a.address[1]>this.address[1]},a.prototype.isAfter=function(a){return a.address[0]===this.address[0]&&a.address[1]<this.address[1]},a.prototype.isAbove=function(a){return a.address[0]>this.address[0]&&a.address[1]===this.address[1]},a.prototype.isBelow=function(a){return a.address[0]<this.address[0]&&a.address[1]===this.address[1]},a.prototype.addClass=function(a){return this.element.classList.add(a)},a.prototype.removeClass=function(a){return this.element.classList.remove(a)},a.prototype.isBeingEdited=function(){return null!=this.control.parentNode},a.prototype.toggleActive=function(){return this.isActive()?this.removeFromSelection():this.makeActive(!1)},a.prototype.events=function(a){var b,c;return c=a.table,this.element.onclick=function(b){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(l=!0,a.col.onClick&&(l=a.col.onClick(a,b)),l!==!1&&(k=b.ctrlKey,j=b.metaKey,n=b.shiftKey,(k||j)&&a.toggleActive(),n)){if(e=c.activeCells[0],g=e.address[0],f=e.address[1],i=a.address[0],h=a.address[1],d=function(a){var b,d,e,g,i,j;if(h>=f){for(i=[],d=e=f;h>=f?h>=e:e>=h;d=h>=f?++e:--e)b=c.getCell(a,d),i.push(b.makeActive(!1));return i}for(j=[],d=g=h;f>=h?f>=g:g>=f;d=f>=h?++g:--g)b=c.getCell(a,d),j.push(b.makeActive(!1));return j},i>=g){for(q=[],m=o=g;i>=g?i>=o:o>=i;m=i>=g?++o:--o)q.push(d(m));return q}for(r=[],m=p=i;g>=i?g>=p:p>=g;m=g>=i?++p:--p)r.push(d(m));return r}},this.element.ondblclick=function(){return a.edit()},this.element.onmousedown=function(b){if(3===b.which)c.contextMenu.show(b.x,b.y,a);else if(!(b.shiftKey||b.ctrlKey||b.metaKey))return c.state="selecting",a.makeActive()},this.element.onmouseover=function(){return"selecting"===c.state?(c.selectionEnd=a,c.setSelection()):void 0},this.element.onmouseup=function(b){return 3===b.which||(c.selectionEnd=a,c.state="ready",b.metaKey||b.ctrlKey)?void 0:c.setSelection()},this.control.onkeydown=function(b){var d,e;switch(d=b.which){case 13:return a.edit(this.value),null!=(e=a.below())?e.makeActive():void 0;case 9:return a.edit(this.value),moveTo(c.nextCell())}},c.mobile?(b=null,this.element.ontouchstart=function(a){return b=a.changedTouches[0].clientY,t.prototype.clearActiveCells(c),c.openCell?c.openCell.hideControl():void 0},this.element.ontouchend=function(c){var d;return d=c.changedTouches[0].clientY,c.changedTouches.length<2&&d===b?(c.preventDefault(),a.edit()):void 0}):void 0},a}(),d=function(){function a(a){var b,c,d,e,f,g,h,i;if(this.table=a,this.userDefinedActions=this.table.config.contextMenuItems,this.userDefinedOrder=this.table.config.contextMenuOrder,d=/Mac/.test(navigator.platform)?"Cmd":"Ctrl",this.actionNodes={},this.actionCallbacks={byName:{},byControl:{}},this.borderedCells=[],this.defaultActions={cut:{name:"Cut",shortCut:d+"+X",callback:this.cut},copy:{name:"Copy",shortCut:d+"+C",callback:this.copy},paste:{name:"Paste",shortCut:d+"+V",callback:this.paste},undo:{name:"Undo",shortCut:d+"+Z",callback:this.undo},redo:{name:"Redo",shortCut:d+"+Y",callback:this.redo},fill:{name:"Fill",shortCut:"",hasDivider:!0,callback:this.fill},selectAll:{name:"Select All",shortCut:d+"+A",callback:this.selectAll},insertBelow:{name:"Insert Row Below",shortCut:"",callback:this.insertBelow},insertAbove:{name:"Insert Row Above",shortCut:"",callback:this.insertAbove},removeRow:{name:"Remove Row",shortCut:"",callback:this.removeRow}},this.element=document.createElement("div"),this.element.style.position="fixed",this.menu=document.createElement("ul"),t.prototype.setAttributes(this.menu,{"class":"dropdown-menu",role:"menu","aria-labelledby":"aria-labelledby",style:"display:block;position:static;margin-bottom:5px;"}),this.userDefinedOrder)for(g=this.userDefinedOrder,e=0,f=g.length;f>e;e++)c=g[e],b=this.userDefinedActions?this.userDefinedActions[c]||this.defaultActions[c]:this.defaultActions[c],b&&this.addAction(b);else{h=this.defaultActions;for(c in h)b=h[c],(!this.userDefinedActions||!this.userDefinedActions[c]&&this.userDefinedActions[c]!==!1)&&this.addAction(b);i=this.userDefinedActions;for(c in i)b=i[c],this.addAction(b)}this.element.appendChild(this.menu),this.events(this)}return a.prototype.addDivider=function(){var a;return a=document.createElement("li"),t.prototype.setAttributes(a,{"class":"divider"}),this.menu.appendChild(a)},a.prototype.addAction=function(a){var b,c,d,e,f,g,h;return f=document.createElement("li"),f.setAttribute("name",a.name),d=document.createElement("div"),h=document.createElement("span"),h.textContent=a.shortCut,t.prototype.setAttributes(h,{style:"float: right !important;"}),b=document.createElement("a"),b.textContent=a.name,b.setAttribute("name",a.name),t.prototype.setAttributes(b,{"class":"enabled",tabIndex:"-1"}),a.hasDivider&&this.addDivider(),b.appendChild(h),f.appendChild(b),this.actionNodes[a.name]=f,this.actionCallbacks.byName[a.name]=a.callback,g=a.shortCut,g&&/(ctrl|cmd)/i.test(g)&&(e=g.split("+")[1],c=e.charCodeAt(0),this.actionCallbacks.byControl[c]=a.callback),this.menu.appendChild(f)},a.prototype.show=function(a,b,c){return this.cell=c,c.isActive()||c.makeActive(),this.cells=c.table.activeCells,t.prototype.setStyles(this.element,{left:a,top:b}),this.table.tableEl.appendChild(this.element)},a.prototype.hide=function(){return this.isVisible()?this.table.tableEl.removeChild(this.element):void 0},a.prototype.isVisible=function(){return null!=this.element.parentNode},a.prototype.getTargetPasteCell=function(){return this.table.activeCells.sort(this.sortFunc)[0]},a.prototype.sortFunc=function(a,b){return a.address[0]-b.address[0]},a.prototype.displayBorders=function(){return this.table.copiedGridChange?this.table.copiedGridChange.displayBorders():void 0},a.prototype.hideBorders=function(){return this.table.copiedGridChange?this.table.copiedGridChange.removeBorders():void 0},a.prototype.cut=function(a,b){var c,d;return d=b.contextMenu,d.hideBorders(),c=new h(b.activeCells,"ge-blank"),c.apply(!1,!1),b.copiedGridChange=c,b.addToStack({type:"cut",grid:c}),d.displayBorders(),d.hide()},a.prototype.copy=function(a,b){var c;return c=b.contextMenu,b.copiedGridChange=new h(b.activeCells),c.displayBorders(),c.hide()},a.prototype.paste=function(a,b){var c,d,e,f,g;return e=b.contextMenu,e.hide(),c=e.getTargetPasteCell(),c.editable?(d=b.copiedGridChange,f=c.address[0],g=c.address[1],d.apply(f,g),b.addToStack({type:"paste",grid:d,x:f,y:g})):void 0},a.prototype.fill=function(a,b){var c,d,e,f;return f=b.contextMenu,c=f.getTargetPasteCell(),d=c.value(),e=new h(b.activeCells,d),e.apply(!1,!1),b.addToStack({type:"fill",grid:e}),f.hide()},a.prototype.selectAll=function(a,b){var c,d,e,f,g,h;for(b.clearActiveCells(),g=b.rows,h=[],e=0,f=g.length;f>e;e++)d=g[e],h.push(function(){var a,b,e,f;for(e=d.cells,f=[],a=0,b=e.length;b>a;a++)c=e[a],f.push(c.addToSelection());return f}());return h},a.prototype.insertBelow=function(a,b){return b.insertBelow()},a.prototype.insertAbove=function(a,b){return b.insertAbove()},a.prototype.removeRow=function(a,b){var c;return c=b.contextMenu.getTargetPasteCell(),b.removeRow(c.row.index)},a.prototype.undo=function(a,b){return b.undo()},a.prototype.redo=function(a,b){return b.redo()},a.prototype.toggle=function(a){var b;return b=this.actionNodes[a].classList,b.toggle("enabled"),b.toggle("disabled")},a.prototype.events=function(a){return this.element.onclick=function(b){var c;return c=b.target.getAttribute("name"),a.actionCallbacks.byName[c](b,a.table)}},a}(),f=function(){function a(a){var b;this.cell=a,b=document.createTextNode(this.cell.col.format(this.cell.originalValue)),this.cell.control=document.createElement("input"),this.cell.element.appendChild(b)}return a.prototype.initControl=function(){return this.cell.control.value=this.cell.value()},a.prototype.formatValue=function(a){return a},a.prototype.setValue=function(a){return this.cell.source[this.cell.valueKey]=a},a.prototype.value=function(){return this.cell.value()},a.prototype.render=function(){return this.cell.element.textContent},a.prototype.select=function(){return this.cell.control.select()},a}(),q=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return x(b,a),b}(f),m=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return x(b,a),b.prototype.formatValue=function(a){return Number(a)},b.prototype.setValue=function(a){return this.cell.source[this.cell.valueKey]=Number(a)},b}(f),e=function(a){function b(a){var b;this.cell=a,b=document.createTextNode(this.toDateString(this.cell.originalValue)),this.cell.control=this.toDate(),this.cell.originalValue&&(this.cell.control.valueAsDate=new Date(this.cell.originalValue)),this.cell.element.appendChild(b)}return x(b,a),b.prototype.formatValue=function(a){return a.length>0?this.toDateString(Date.parse(a)):a instanceof Date?this.toDateString(a):0===a.length?(this.cell.control.valueAsDate=null,""):void 0},b.prototype.setValue=function(a){return this.cell.source[this.cell.valueKey]=new Date(a),this.cell.control.valueAsDate=new Date(a)},b.prototype.initControl=function(){return b.__super__.initControl.call(this),this.cell.control.value=this.toDateInputString(this.cell.value())},b.prototype.value=function(){return this.cell.control.valueAsDate},b.prototype.toDateString=function(a){var b;return null==a&&(a=null),a&&""!==a?b=new Date(a):this.value()&&(b=new Date(this.value())),b instanceof Date?("0"+(b.getMonth()+1)).slice(-2)+"-"+("0"+b.getDate()).slice(-2)+"-"+b.getFullYear():""},b.prototype.toDate=function(){var a;return a=document.createElement("input"),a.type="date",a.value=this.toDateString(),a},b.prototype.toDateInputString=function(a){var b;return null==a&&(a=null),a&&""!==a?b=new Date(a):this.value()&&(b=new Date(this.value())),b instanceof Date?b.getFullYear()+"-"+("0"+(b.getMonth()+1)).slice(-2)+"-"+("0"+b.getDate()).slice(-2):""},b}(f),j=function(a){function b(a){var b;this.cell=a,this.cell.htmlContent=this.cell.col.defaultValue||this.cell.originalValue||"",b=this.toFragment(),this.cell.control=document.createElement("input"),this.cell.element.appendChild(b)}return x(b,a),b.prototype.setValue=function(a){var b;return this.cell.htmlContent=a,b=this.toFragment(),this.cell.element.innerHTML="",this.cell.element.appendChild(b)},b.prototype.toFragment=function(){var a,b;return a=document.createElement("div"),b=document.createDocumentFragment(),a.innerHTML=this.cell.htmlContent,b.appendChild(a.firstChild||document.createTextNode("")),b},b.prototype.render=function(){return this.htmlContent},b}(f),o=function(a){function b(a){var b;this.cell=a,b=document.createTextNode(this.cell.originalValue||""),this.cell.element.appendChild(b),this.initControl()}return x(b,a),b.prototype.initControl=function(){var a,b,c,d,e,f,g,h,i,j,k;for(a=this.cell,e=document.createElement("select"),this.cell.meta.choices||console.log("There is not a 'choices' key in cell "+this.cell.address+" and you specified that it was of type 'select'"),k=this.cell.meta.choices,g=0,i=k.length;i>g;g++){if(b=k[g],d=document.createElement("option"),b instanceof Array)for(c=h=0,j=b.length;j>h;c=++h)f=b[c],0===c&&(d.value=f),1===c&&(d.text=f);else d.value=d.text=b;a.value()===b&&(d.selected=!0),e.add(d)}return e.classList.add("form-control"),e.onchange=function(b){return a.edit(b.target.value)},this.cell.control=e},b.prototype.select=function(){},b}(f),s=function(a){function b(a){var b;this.cell=a,b=document.createTextNode(this.cell.originalValue||""),this.cell.element.appendChild(b),this.cell.control=document.createElement("textarea"),this.cell.control.classList.add("form-control")}return x(b,a),b}(f),h=function(){function a(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;for(this.cells=a,j="ge-blank"===b,this.changes=[],this.table=this.cells[0].col.table,this.borderStyle=this.table.config.selectionBorderStyle||"2px dashed blue",this.highRow=0,this.highCol=0,l=0,n=a.length;n>l;l++)d=a[l],h=d.address[0],f=d.address[1],i={row:h,col:f,value:j?"":b||d.value()},this.firstCell?i.row<this.firstCell.row?this.firstCell=i:i.row===this.firstCell.row&&i.col<this.firstCell.col&&(this.firstCell=i):(this.firstCell=i,this.lowRow=i.row,this.lowCol=i.col),i.row>this.highRow&&(this.highRow=i.row),i.col>this.highCol&&(this.highCol=i.col),i.row<this.lowRow&&(this.lowRow=i.row),i.col<this.lowCol&&(this.lowCol=i.col),this.changes.push(i);for(p=this.changes,m=0,o=p.length;o>m;m++)e=p[m],e.rowVector=e.row-this.firstCell.row,e.colVector=e.col-this.firstCell.col;k=this.highCol-this.lowCol+1,g=this.highRow-this.lowRow+1,c=k*g,this.scattered=this.cells.length!==c}return a.prototype.apply=function(a,b){var c,d,e,f,g,h;for((a===!1||b===!1)&&(a=this.firstCell.row,b=this.firstCell.col),g=this.changes,h=[],e=0,f=g.length;f>e;e++)d=g[e],c=this.table.getCell(a+d.rowVector,b+d.colVector),c&&c.editable?(d.oldValue=c.value(),h.push(c.value(d.value,!1))):h.push(d.oldValue="");return h},a.prototype.undo=function(a,b){var c,d,e,f,g,h;for((a===!1||b===!1)&&(a=this.firstCell.row,b=this.firstCell.col),g=this.changes,h=[],e=0,f=g.length;f>e;e++)d=g[e],c=this.table.getCell(a+d.rowVector,b+d.colVector),h.push(c&&c.editable?c.value(d.oldValue,!1):void 0);return h},a.prototype.displayBorders=function(){var a,b,c,d,e;for(d=this.cells,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(this.addBorder(a));return e},a.prototype.removeBorders=function(){var a,b,c,d,e;for(d=this.cells,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.element.style.border="");return e},a.prototype.addBorder=function(a){var b,c;return c=a.address[0],b=a.address[1],this.scattered?a.element.style.border=this.borderStyle:(this.firstCell.row===this.highRow?(a.element.style.borderTop=this.borderStyle,a.element.style.borderBottom=this.borderStyle):c===this.lowRow?a.element.style.borderTop=this.borderStyle:c===this.highRow&&(a.element.style.borderBottom=this.borderStyle),this.firstCell.col===this.highCol?(a.element.style.borderRight=this.borderStyle,a.element.style.borderLeft=this.borderStyle):b===this.lowCol?a.element.style.borderLeft=this.borderStyle:b===this.highCol?a.element.style.borderRight=this.borderStyle:void 0)},a}(),a=function(){function a(a){this.table=a,this.index=-1,this.actions=[]}return a.prototype.getCell=function(a){return this.table.getCell(a.address[0],a.address[1])},a.prototype.addAction=function(a){return this.actions.length>0&&this.index<this.actions.length-1&&(this.actions=this.actions.splice(0,this.index+1)),this.actions.push(a),this.index++
},a.prototype.undo=function(){var a,b;if(this.index>-1)switch(this.index--,a=this.actions[this.index+1],a.type){case"cell-edit":return b=this.getCell(a),b.value(a.oldValue,!1);case"cut":return a.grid.undo(!1,!1);case"paste":return a.grid.undo(a.x,a.y);case"fill":return a.grid.undo(!1,!1);case"add-row":return this.table.removeRow(a.index,!1);case"remove-row":return this.table.addRow(a.index,!1,a.rowObject);case"move-row":return this.table.moveRow(a.newIndex,a.oldIndex,!1)}},a.prototype.redo=function(){var a,b;if(this.index<this.actions.length-1)switch(this.index++,a=this.actions[this.index],a.type){case"cell-edit":return b=this.table.getCell(a.address[0],a.address[1]),b.value(a.newValue,!1);case"cut":return a.grid.apply(!1,!1);case"paste":return a.grid.apply(a.x,a.y);case"fill":return a.grid.apply(!1,!1);case"add-row":return this.table.addRow(a.index,!1,a.rowObject);case"remove-row":return this.table.removeRow(a.index,!1);case"move-row":return this.table.moveRow(a.oldIndex,a.newIndex,!1)}},a}(),k=function(){function a(a){var b,c;this.row=a,a=this.row,c=a.table,this.element=document.createElement("td"),this.element.setAttribute("draggable",!0),this.element.className="handle",b=document.createElement("div"),b.innerHTML="<span></span><span></span><span></span>",this.element.appendChild(b),this.element.onclick=function(b){var c;return c=a.index,a.table.selectRow(b,c)},this.element.ondragstart=function(){return t.prototype.clearActiveCells(c),a.select(),c.draggingRow=a},this.element.ondragend=function(){var a,b,d,e;return e=c.draggingRow.index,b=c.lastDragOver.index,d=0!==b||c.lastDragOverIsBeforeFirstRow?0:1,a=b+d,c.lastDragOver.element.style.borderBottom=c.lastDragOver.oldBorderBottom,c.lastDragOver.element.style.borderTop=c.lastDragOver.oldBorderTop,c.lastDragOver.element.style.borderTop=c.lastDragOver.oldBorderTop,c.lastDragOver=null,c.moveRow(e,a)}}return a}(),n=function(){function a(a,b){var c;this.attributes=a,this.table=b,this.id=this.table.rows.length,this.cells=[],this.index=this.table.rows.length,this.element=document.createElement("tr"),this.cssClass=this.attributes.cssClass,this.cssClass&&(this.element.className=this.cssClass),this.oldBorderBottom=this.element.style.borderBottom,this.oldBorderTop=this.element.style.borderTop,this.type=this.attributes.gridEditRowType,b=this.table,c=this,this.element.ondragenter=function(){var a;return b.lastDragOverIsBeforeFirstRow=!1,a=b.lastDragOver,a?0!==c.index&&a.index===c.index||(a.element.style.borderBottom=c.oldBorderBottom,c.element.style.borderBottom=b.dragBorderStyle):c.element.style.borderBottom=b.dragBorderStyle,b.lastDragOver=c},this.includeRowHandles=this.table.config.includeRowHandles,t.prototype.setAttributes(this.element,{id:"row-"+this.id})}return a.prototype.below=function(){return this.table.rows[this.index+1]},a.prototype.above=function(){return this.table.rows[this.index-1]},a.prototype.select=function(){var a,b,c,d,e;for(d=this.cells,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.addToSelection());return e},a.prototype.afterEdit=function(){return this.table.calculateSubtotals()},a.prototype.addHandle=function(){var a;return this.includeRowHandles?(a=new k(this),this.element.appendChild(a.element)):void 0},a}(),g=function(a){function c(a,d){var e,f,g,h,i,j;for(this.attributes=a,this.table=d,c.__super__.constructor.apply(this,arguments),this.editable=!0,this.addHandle(),j=this.table.cols,g=h=0,i=j.length;i>h;g=++h)f=j[g],e=new b(this.attributes[f.valueKey],this),this.cells.push(e),this.table.cols[g].cells.push(e),this.element.appendChild(e.element);delete this.attributes}return x(c,a),c}(n),p=function(a){function b(a,c){this.attributes=a,this.table=c,b.__super__.constructor.apply(this,arguments),this.addHandle(),this.editable=this.attributes.editable=!1,this.element.innerHTML=this.attributes.html,this.type="static",delete this.attributes}return x(b,a),b}(n),r=function(a){function c(a,d){var e,f,g,h,i,j,k;for(this.attributes=a,this.table=d,c.__super__.constructor.apply(this,arguments),this.subtotalColumns={},this.labels=this.attributes.labels,this.running=this.attributes.running,this.addHandle(),k=this.table.cols,g=i=0,j=k.length;j>i;g=++i)f=k[g],e=new b("",this),e.editable=!1,this.labels&&(h=this.labels[f.valueKey],e.element.innerHTML=h||""),this.cells.push(e),this.table.cols[g].cells.push(e),this.element.appendChild(e.element),this.attributes.subtotal[f.valueKey]&&(this.subtotalColumns[f.valueKey]=g);this.table.subtotalRows.push(this),this.calculate()}return x(c,a),c.prototype.calculate=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o;if(f=-1,!this.running)for(m=this.table.subtotalRows,i=0,k=m.length;k>i;i++)g=m[i],e=g.index,e<this.index&&e>f&&(f=e);n=this.subtotalColumns;for(b in n){for(c=n[b],h=0,o=this.table.rows,j=0,l=o.length;l>j;j++)if(d=o[j],d.index>f){if(d.index===this.index)break;"subtotal"!==d.type&&"header"!==d.type&&(a=d.cells[c],a&&(h+=Number(a.value())))}this.cells[c].value(h,!1)}return delete this.attributes,this},c.prototype.afterEdit=function(){},c}(n),l=function(a){function c(a,d){var e,f,g,h,i,j;for(this.attributes=a,this.table=d,c.__super__.constructor.apply(this,arguments),this.editable=!0,this.addHandle(),j=this.table.cols,g=h=0,i=j.length;i>h;g=++h)f=j[g],e=new b(this.attributes[f.valueKey],this,"html"),this.cells.push(e),this.table.cols[g].cells.push(e),this.element.appendChild(e.element);delete this.attributes}return x(c,a),c}(n),u="undefined"!=typeof exports&&null!==exports?exports:window,u.GridEdit=i}).call(this);