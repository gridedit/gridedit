(function(){var a,b,c,d,e,f,g=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};e=function(){function a(){}return a.prototype.setAttributes=function(a,b){var c,d,e;e=[];for(c in b)d=b[c],e.push(d?a.setAttribute(c,d):void 0);return e},a.prototype.setStyles=function(a,b){var c,d,e;e=[];for(c in b)d=b[c],e.push(a.style[c]=""+d+"px");return e},a.prototype.clearActiveCells=function(a){var b,c,d,e,f,g,h,i,j;if(f=a.redCells,c=a.activeCells,f.length>0){for(d=g=0,i=f.length;i>g;d=++g)e=f[d],null!=e&&e.removeClass("uneditable");a.redCells=[]}if(c.length>0){for(d=h=0,j=c.length;j>h;d=++h)b=c[d],null!=b&&b.removeClass("active"),null!=b&&b.hideControl;a.activeCells=[]}return a.selectionStart=null,a.selectionEnd=null,a.contextMenu.hide()},a.prototype.capitalize=function(a){return a.toLowerCase().replace(/\b./g,function(a){return a.toUpperCase()})},a}(),c=function(){function a(a){var c,d,e;if(this.config=a,this.element=document.querySelectorAll(this.config.element||"#gridedit")[0],this.headers=[],this.rows=[],this.cols=this.config.cols,this.source=this.config.rows,this.redCells=[],this.activeCells=[],this.copiedCells=[],this.selectionStart=null,this.selectionEnd=null,this.openCell=null,this.state="ready",this.config.custom){e=this.config.custom;for(c in e)d=e[c],c in this.config.custom&&this.set(c,d);delete this.config.custom}this.config.initialize&&this.init(),this.contextMenu=new b(["cut","copy","paste","fill"],this)}return a.prototype.init=function(){this.config.beforeInit&&this.config.beforeInit(),this.build(),this.events(),this.render(),this.config.afterInit&&this.config.afterInit()},a.prototype.build=function(){var a,b,c,f,g,h,i,j,k,l,m,n,o,p,q,r;for(l=document.createElement("tr"),q=this.config.cols,m=0,o=q.length;o>m;m++)a=q[m],j=document.createElement("th"),"object"==typeof a?i=document.createTextNode(a.label):"string"==typeof header&&(i=document.createTextNode(header)),j.appendChild(i),l.appendChild(j);for(k=document.createElement("thead"),k.appendChild(l),h=document.createElement("tbody"),r=this.source,b=n=0,p=r.length;p>n;b=++n)f=r[b],c=new d(f,this),this.rows.push(c),h.appendChild(c.element);return g=document.createElement("table"),e.prototype.setAttributes(g,{id:"editable-grid","class":this.config.tableClass}),g.appendChild(k),g.appendChild(h),this.tableEl=g},a.prototype.rebuild=function(a){var b,c;if(null==a&&(a=null),b=Object.create(this.config),null!==a)for(c in a)a[c]&&(b[c]=a[c]);return this.destroy(),this.constructor(b)},a.prototype.events=function(){var a,b,c;return c=this,b=c.moveTo,a=c.edit,document.onkeydown=function(d){var e,f,h,i,j;if(c.activeCell())switch(h=d.keyCode,i=d.shiftKey,f=d.ctrlKey,e=d.metaKey,j=function(a,b){var c;return c=String.fromCharCode(a),b?void 0:c.toLowerCase()},h){case 39:if(!c.activeCell().isBeingEdited())return b(c.nextCell());break;case 9:return b(i?c.previousCell():c.nextCell());case 37:return b(c.previousCell());case 38:return b(c.aboveCell());case 40:return b(c.belowCell());case 32:if(!c.openCell)return a(c.activeCell());break;case 67:if(e||f)return c.copy();break;case 86:if(e||f)return c.paste();break;case 13:break;case 16:break;case 17:break;case 91:break;case 8:if(!c.openCell)return d.preventDefault(),c.activeCell().value("");break;case 46:if(!c.openCell)return d.preventDefault(),c.activeCell().value("");break;default:if(g.call([96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111],h)>=0&&(h-=48),!c.openCell)return c.activeCell().showControl(j(h))}},window.onresize=function(){return c.openCell?e.prototype.setStyles(c.openCell.control,c.openCell.position()):void 0},window.onscroll=function(){return c.openCell?c.openCell.reposition():void 0},this.tableEl.oncontextmenu=function(){return!1},document.onclick=function(a){return c.isDescendant(a.target)?void 0:e.prototype.clearActiveCells(c)}},a.prototype.render=function(){return this.element.hasChildNodes()&&(this.element=document.querySelectorAll(this.config.element||"#gridedit")[0]),this.element.appendChild(this.tableEl)},a.prototype.set=function(a,b){return void 0!==a?this.config[a]=b:void 0},a.prototype.getCell=function(a,b){return this.rows[a].cells[b]},a.prototype.activeCell=function(){return this.activeCells.length>1?this.activeCells:this.activeCells[0]},a.prototype.nextCell=function(){var a;return null!=(a=this.activeCell())?a.next():void 0},a.prototype.previousCell=function(){var a;return null!=(a=this.activeCell())?a.previous():void 0},a.prototype.aboveCell=function(){var a;return null!=(a=this.activeCell())?a.above():void 0},a.prototype.belowCell=function(){var a;return null!=(a=this.activeCell())?a.below():void 0},a.prototype.moveTo=function(a){return null!=a&&a.makeActive(),!1},a.prototype.edit=function(a,b){return null==b&&(b=null),null!==b?null!=a?a.edit(b):void 0:(null!=a&&a.edit(),!1)},a.prototype.setSelection=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(this.selectionStart!==this.selectionEnd){for(l=this.activeCells,f=0,h=l.length;h>f;f++)a=l[f],a.removeFromSelection();for(this.activeCells=[],e=function(){o=[];for(var a=m=this.selectionStart.address[0],b=this.selectionEnd.address[0];b>=m?b>=a:a>=b;b>=m?a++:a--)o.push(a);return o}.apply(this),c=function(){p=[];for(var a=n=this.selectionStart.address[1],b=this.selectionEnd.address[1];b>=n?b>=a:a>=b;b>=n?a++:a--)p.push(a);return p}.apply(this),g=0,i=e.length;i>g;g++)for(d=e[g],k=0,j=c.length;j>k;k++)b=c[k],this.rows[d].cells[b].addToSelection()}},a.prototype.data=function(){var a,b,c,d,e,f,g,h,i,j;for(b=[],i=this.rows,e=0,g=i.length;g>e;e++){for(c=i[e],d=[],j=c.cells,f=0,h=j.length;h>f;f++)a=j[f],d.push("date"===a.type?a.control.valueAsDate:a.value());b.push(d)}return b},a.prototype.repopulate=function(){var a,b,c,d,e,f;for(e=this.rows,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(function(){var c,d,e,f;for(e=b.cells,f=[],c=0,d=e.length;d>c;c++)a=e[c],f.push(a.value(a.source[a.valueKey]));return f}());return f},a.prototype.destroy=function(){var a,b;this.element.removeChild(this.tableEl),b=[];for(a in this)b.push(delete this[a]);return b},a.prototype.copy=function(a){return null==a&&(a=this.activeCells),this.copiedCells=a},a.prototype.paste=function(a){return null==a&&(a=this.activeCells),this.activeCells=this.copiedCells},a.prototype.cut=function(){},a.prototype.filldown=function(){},a.prototype.isDescendant=function(a){var b;for(b=a.parentNode;null!=b;){if(b===this.tableEl)return!0;b=b.parentNode}return!1},a}(),d=function(){function b(b,c){var d,f,g,h,i;for(this.attributes=b,this.table=c,this.id=this.table.rows.length,this.cells=[],this.index=this.table.rows.length,this.element=document.createElement("tr"),this.editable=!0,e.prototype.setAttributes(this.element,{id:"row-"+this.id}),i=this.table.cols,g=0,h=i.length;h>g;g++)f=i[g],d=new a(this.attributes[f.valueKey],this),this.cells.push(d),this.element.appendChild(d.element);delete this.attributes}return b.prototype.below=function(){return this.table.rows[this.id+1]},b.prototype.above=function(){return this.table.rows[this.id-1]},b}(),a=function(){function a(a,b){var c,d,f,g;if(this.attributes=a,this.row=b,this.id=""+this.row.id+"-"+this.row.cells.length,this.address=[this.row.id,this.row.cells.length],this.index=this.row.cells.length,this.table=this.row.table,this.col=this.table.cols[this.index],this.type=this.col.type,this.meta=this.col,this.editable="editable"in this.col?this.col.editable:!0,this.element=document.createElement("td"),this.originalValue=this.attributes,this.val=this.originalValue,this.previousValue=null,this.valueKey=this.col.valueKey,this.source=this.table.config.rows[this.address[0]],this.beforeEdit=this.table.config.beforeEdit,this.afterEdit=this.table.config.afterEdit,this.beforeActivate=this.table.config.beforeCellActivate,this.afterActivate=this.table.config.afterCellActivate,this.beforeControlInit=this.table.config.beforeControlInit,this.afterControlInit=this.table.config.afterControlInit,this.onClick=this.table.config.onCellClick,e.prototype.setAttributes(this.element,{id:"cell-"+this.id,"class":(null!=(f=this.attributes)?f["class"]:void 0)||"",style:(null!=(g=this.attributes)?g.styles:void 0)||""}),this.col.style)for(d in this.col.style)this.element.style[d]=this.col.style[d];switch(this.type){case"string":c=document.createTextNode(this.attributes),this.control=document.createElement("input");break;case"number":c=document.createTextNode(this.attributes),this.control=document.createElement("input");break;case"date":c=document.createTextNode(this.toDateString(this.attributes)),this.control=this.toDate();break;case"html":this.htmlContent=this.attributes,c=this.toFragment(),this.control=document.createElement("input");break;case"select":c=document.createTextNode(this.attributes||""),this.control=this.toSelect()}this.element.appendChild(c),this.events(this)}return a.prototype.setNewHTMLValue=function(a){var b;return this.htmlContent=a,b=this.toFragment(),this.element.innerHTML="",this.element.appendChild(b)},a.prototype.value=function(a){var b;return null==a&&(a=null),null!==a&&a!==this.element.textContent?("date"===this.type&&(a.length>0?a=this.toDateString(Date.parse(a)):a instanceof Date?a=this.toDateString(a):0===a.length&&(a="",this.control.valueAsDate=null)),b=this.value(),this.beforeEdit&&this.beforeEdit(this,b,a),this.previousValue=this.element.textContent,this.element.textContent=a,"number"===this.type?this.source[this.valueKey]=Number(a):"date"===this.type?this.source[this.valueKey]=new Date(a):"html"===this.type?this.setNewHTMLValue(a):this.source[this.valueKey]=a,e.prototype.setStyles(this.control,this.position()),this.afterEdit&&this.afterEdit(this,b,a),a):"html"!==this.type?this.element.textContent:this.htmlContent},a.prototype.makeActive=function(){var a;return e.prototype.clearActiveCells(this.table),this.beforeActivate(this)&&(a=this.beforeActivate(this)),(this.beforeActivate&&a!==!1||!this.beforeActivate)&&(this.addClass("active"),this.table.activeCells.push(this),this.table.selectionStart=this,this.table.openCell&&this.table.openCell.edit(this.table.openCell.control.value),this.afterActivate(this))?this.afterActivate(this):void 0},a.prototype.addToSelection=function(){return this.addClass("active"),this.table.activeCells.push(this)},a.prototype.isActive=function(){return-1!==this.table.activeCells.indexOf(this)},a.prototype.removeFromSelection=function(){return this.removeClass("active")},a.prototype.showRed=function(){return this.addClass("uneditable"),this.table.redCells.push(this)},a.prototype.showControl=function(a){var b,c,d;return null==a&&(a=null),this.editable?(this.beforeControlInit&&(b=this.beforeControlInit(this)),(this.beforeControlInit&&b!==!1||!this.beforeControlInit)&&(null!==a?("date"===this.type?this.control.valueAsDate=new Date(this.value()):this.control.value=a,this.control.value=a,d=this.control,setTimeout(function(){return d.focus()},0)):"select"===this.type&&(this.control=this.toSelect(),c=this,this.control.onchange=function(a){return c.edit(a.target.value)}),this.control.style.position="fixed",e.prototype.setStyles(this.control,this.position()),this.table.element.appendChild(this.control),this.table.openCell=this,this.afterControlInit)?this.afterControlInit(this):void 0):this.showRed()},a.prototype.hideControl=function(){return null!==this.table.openCell?(this.table.element.removeChild(this.control),this.table.openCell=null):void 0},a.prototype.edit=function(a){return null==a&&(a=null),this.editable?null!==a?(this.value(a),this.isBeingEdited()?this.hideControl():this.edit()):(this.showControl(),this.control.focus(),"select"!==this.type?this.control.select():void 0):this.showRed()},a.prototype.position=function(){return this.element.getBoundingClientRect()},a.prototype.reposition=function(){return e.prototype.setStyles(this.control,this.position())},a.prototype.next=function(){return this.row.cells[this.index+1]},a.prototype.previous=function(){return this.row.cells[this.index-1]},a.prototype.above=function(){var a;return null!=(a=this.row.above())?a.cells[this.index]:void 0},a.prototype.below=function(){var a;return null!=(a=this.row.below())?a.cells[this.index]:void 0},a.prototype.addClass=function(a){return this.element.classList.add(a)},a.prototype.removeClass=function(a){return this.element.classList.remove(a)},a.prototype.toFragment=function(){var a,b;return a=document.createElement("div"),b=document.createDocumentFragment(),a.innerHTML=this.htmlContent,b.appendChild(a.firstChild||document.createTextNode("")),b},a.prototype.toSelect=function(){var a,b,c,d,e,f,g,h,i,j;for(d=document.createElement("select"),this.meta.choices||console.log("There is not a 'choices' key in cell "+this.address+" and you specified that it was of type 'select'"),j=this.meta.choices,f=0,h=j.length;h>f;f++){if(a=j[f],c=document.createElement("option"),a instanceof Array)for(b=g=0,i=a.length;i>g;b=++g)e=a[b],0===b&&(c.value=e),1===b&&(c.text=e);else c.value=c.text=a;this.value()===a&&(c.selected=!0),d.add(c)}return d.classList.add("form-control"),d},a.prototype.toDateString=function(a){var b;return null==a&&(a=null),a&&""!==a?b=new Date(a):this.value()&&(b=new Date(this.value())),b instanceof Date?("0"+(b.getMonth()+1)).slice(-2)+"-"+("0"+b.getDate()).slice(-2)+"-"+b.getFullYear():""},a.prototype.toDate=function(){var a;return a=document.createElement("input"),a.type="date",a.value=this.toDateString(),a},a.prototype.isBeingEdited=function(){return null!=this.control.parentNode},a.prototype.events=function(a){var b,c,d;return d=a.table,c=d.redCells,b=d.activeCells,this.element.onclick=function(b){var c;return a.onClick&&(c=a.onClick(a,b)),c===!1?!1:void 0},this.element.ondblclick=function(){return a.edit()},this.element.onmousedown=function(b){return 3===b.which?void d.contextMenu.show(b.x,b.y,a):(d.state="selecting",a.makeActive(),!1)},this.element.onmouseover=function(){return"selecting"===d.state?(d.selectionEnd=a,d.setSelection()):void 0},this.element.onmouseup=function(b){return 3!==b.which?(d.selectionEnd=a,d.setSelection(),d.state="ready"):void 0},this.control.onkeydown=function(b){var c,d;switch(c=b.which){case 13:return a.edit(this.value),null!=(d=a.below())?d.makeActive():void 0}},this.control.onchange=function(b){return a.edit(b.target.value)}},a}(),b=function(){function a(a,b){var c,d,f,h,i,j,k,l;for(this.actions=a,this.table=b,this.defaultActions=["cut","copy","paste","fill"],this.element=document.createElement("div"),this.actionNodes={},e.prototype.setAttributes(this.element,{id:"contextMenu","class":"dropdown clearfix"}),i=document.createElement("ul"),e.prototype.setAttributes(i,{"class":"dropdown-menu",role:"menu","aria-labelledby":"aria-labelledby",style:"display:block;position:static;margin-bottom:5px;"}),l=this.defaultActions,j=0,k=l.length;k>j;j++)d=l[j],h=document.createElement("li"),f=document.createElement("li"),e.prototype.setAttributes(f,{"class":"divider"}),c=document.createElement("a"),c.textContent=e.prototype.capitalize(d),g.call(this.actions,d)>=0?e.prototype.setAttributes(c,{"class":"enabled",tabIndex:"-1"}):e.prototype.setAttributes(c,{"class":"disabled",tabIndex:"-1"}),"fill"===d&&i.appendChild(f),this.actionNodes[d]=c,h.appendChild(c),i.appendChild(h);this.element.appendChild(i),this.events(this)}return a.prototype.show=function(a,b,c){return c.isActive()?(e.prototype.setStyles(this.element,{left:a,top:b}),this.table.tableEl.appendChild(this.element)):void 0},a.prototype.hide=function(){return this.isVisible()?this.table.tableEl.removeChild(this.element):void 0},a.prototype.isVisible=function(){return null!=this.element.parentNode},a.prototype.toggle=function(a){var b;return b=this.actionNodes[a].classList,b.toggle("enabled"),b.toggle("disabled")},a.prototype.events=function(){return this.element.onclick=function(a){return"Cut"===a.target.textContent&&console.log(a.target.textContent),"Copy"===a.target.textContent&&console.log("copy"),"Paste"===a.target.textContent&&console.log("paste"),"Fill"===a.target.textContent?console.log("fill"):void 0}},a}(),f="undefined"!=typeof exports&&null!==exports?exports:window,f.GridEdit=c}).call(this);